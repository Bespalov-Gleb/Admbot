<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–†–µ—Å—Ç–æ—Ä–∞–Ω</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="/static/styles.v23.css?v=78" />
  <script src="/static/page-transitions.js"></script>
  <style>
    /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
    .cat-row {
      display: flex !important;
      overflow-x: auto !important;
      gap: 12px !important;
      padding: 16px 16px !important;
      position: sticky !important;
      top: 60px !important; /* –°–¥–≤–∏–≥–∞–µ–º –Ω–∏–∂–µ –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
      background: #fff !important;
      border-bottom: 1px solid #f0f0f0 !important;
      z-index: 150 !important; /* –ú–µ–Ω—å—à–µ —á–µ–º —É –∫–Ω–æ–ø–∫–∏ "–ù–∞–∑–∞–¥" */
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;
      scrollbar-width: none !important; /* Firefox */
      -ms-overflow-style: none !important; /* IE/Edge */
    }
    
    .cat-row::-webkit-scrollbar {
      display: none; /* Chrome/Safari/Opera */
    }
    
    .cat-row button {
      padding: 10px 20px !important;
      border-radius: 20px !important;
      border: 1px solid #e5e5e5 !important;
      background: #fff !important;
      color: #333 !important;
      font-weight: 500 !important;
      font-size: 14px !important;
      white-space: nowrap !important;
      cursor: pointer !important;
      transition: all 0.2s ease !important;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05) !important;
    }
    
    .cat-row button:hover {
      border-color: #d0d0d0;
      background: #f8f8f8;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è —Å–≤–∞–π–ø–∞ –≤–ª–µ–≤–æ */
    .swipe-animation {
      transition: transform 0.3s ease-out;
    }
    
    .swipe-closing {
      transform: translateX(-100%);
    }
    
    /* –°–∫—Ä—ã–≤–∞–µ–º —Å–∫—Ä–æ–ª–ª–±–∞—Ä –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏ */
    .swipe-animation body {
      overflow: hidden;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–≥–æ —Ä–µ–π—Ç–∏–Ω–≥–∞ */
    .clickable-rating {
      cursor: pointer;
      transition: all 0.2s ease;
      border-radius: 8px;
      padding: 4px 8px;
    }
    
    .clickable-rating:hover {
      background-color: #f5f5f5;
      transform: scale(1.02);
    }
    
    .reviews-arrow {
      margin-left: 8px;
      color: #666;
      font-size: 14px;
      transition: transform 0.2s ease;
    }
    
    .clickable-rating:hover .reviews-arrow {
      transform: translateX(2px);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤ */
    .review-item {
      border-bottom: 1px solid #f0f0f0;
      padding: 16px 0;
    }
    
    .review-item:last-child {
      border-bottom: none;
    }
    
    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .review-rating {
      color: #ffa500;
      font-size: 16px;
    }
    
    .review-date {
      color: #666;
      font-size: 12px;
    }
    
    .review-comment {
      color: #333;
      line-height: 1.5;
      margin-top: 8px;
    }
    
    .no-reviews {
      text-align: center;
      color: #666;
      padding: 40px 20px;
    }
    
    .loading-text {
      text-align: center;
      color: #666;
      padding: 20px;
    }
    
    .cat-row button.active {
      background: #dc2626 !important;
      border-color: #dc2626 !important;
      color: #fff !important;
      box-shadow: 0 4px 12px rgba(220,38,38,0.3) !important;
    }
    
    /* –ü–ª–∞–≤–Ω—ã–π —Å–∫—Ä–æ–ª–ª –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
    .cat-row {
      scroll-behavior: smooth;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ */
    .restaurant-info-modal {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      background: rgba(0, 0, 0, 0.5) !important;
      z-index: 1001 !important;
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .restaurant-info-modal.show {
      display: block !important;
      opacity: 1 !important;
      visibility: visible !important;
    }
    
    .modal-content {
      position: fixed !important;
      bottom: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 80vh !important;
      background: #fff !important;
      border-radius: 20px 20px 0 0 !important;
      transform: translateY(100%) !important;
      transition: transform 0.3s ease !important;
      overflow-y: auto !important;
      z-index: 1002 !important;
      min-height: 400px !important;
    }
    
      .restaurant-info-modal.show .modal-content {
        transform: translateY(0) !important;
      }
      
      /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
      .modal-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        padding: 16px 20px !important;
        border-bottom: 1px solid #e0e0e0 !important;
        background: #fff !important;
        position: sticky !important;
        top: 0 !important;
        z-index: 10 !important;
      }
      
      .back-button {
        background: none !important;
        border: none !important;
        font-size: 24px !important;
        color: #333 !important;
        cursor: pointer !important;
        padding: 8px !important;
        border-radius: 50% !important;
        transition: background-color 0.2s !important;
      }
      
      .back-button:hover {
        background-color: #f5f5f5 !important;
      }
      
      .modal-title {
        font-size: 18px !important;
        font-weight: 600 !important;
        color: #333 !important;
        margin: 0 !important;
        text-align: center !important;
        flex: 1 !important;
      }
      
      .header-spacer {
        width: 40px !important;
        height: 40px !important;
      }
      
      /* –°—Ç–∏–ª–∏ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –æ—Ç–∑—ã–≤–æ–≤ */
      .review-item {
        padding: 16px 20px !important;
        border-bottom: 1px solid #f0f0f0 !important;
        background: #fff !important;
      }
      
      .review-item:last-child {
        border-bottom: none !important;
      }
      
      .review-header {
        display: flex !important;
        justify-content: space-between !important;
        align-items: center !important;
        margin-bottom: 8px !important;
      }
      
      .reviewer-info {
        display: flex !important;
        align-items: center !important;
        gap: 8px !important;
      }
      
      .thumbs-up-icon {
        width: 28px !important;
        height: 28px !important;
        background: #4CAF50 !important;
        border-radius: 50% !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        position: relative !important;
        flex-shrink: 0 !important;
      }
      
      .thumbs-up-icon::before {
        content: '' !important;
        width: 12px !important;
        height: 12px !important;
        background: #fff !important;
        border-radius: 2px 2px 0 0 !important;
        position: relative !important;
        transform: rotate(-45deg) !important;
        margin-top: 2px !important;
      }
      
      .thumbs-up-icon::after {
        content: '' !important;
        width: 8px !important;
        height: 8px !important;
        background: #fff !important;
        border-radius: 0 0 2px 2px !important;
        position: absolute !important;
        bottom: 6px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
      }
      
      .reviewer-name {
        font-weight: 600 !important;
        font-size: 16px !important;
        color: #333 !important;
      }
      
      .review-date {
        font-size: 14px !important;
        color: #666 !important;
      }
      
      .review-text {
        font-size: 15px !important;
        color: #333 !important;
        line-height: 1.4 !important;
        margin-bottom: 8px !important;
      }
      
      .ordered-items {
        font-size: 13px !important;
        color: #888 !important;
        line-height: 1.3 !important;
        font-style: italic !important;
      }
      
      .no-reviews {
        text-align: center !important;
        padding: 40px 20px !important;
        color: #666 !important;
        font-size: 16px !important;
      }
      
      /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–≤–∞–π–ø–∞ */
      body {
        transition: transform 0.2s ease-out, opacity 0.2s ease-out !important;
        cursor: grab !important;
      }
      
      body:active {
        cursor: grabbing !important;
      }
      
      .swipe-animation {
        transition: transform 0.25s ease-in, opacity 0.25s ease-in !important;
      }
      
      .swipe-closing {
        transform: translateX(-100%) !important;
        opacity: 0 !important;
      }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      border-bottom: 1px solid #f0f0f0;
    }
    
    .modal-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 24px;
      color: #666;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s ease;
    }
    
    .close-modal:hover {
      background-color: #f0f0f0;
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .info-section {
      margin-bottom: 24px;
    }
    
    .info-section h3 {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 12px;
    }
    
    .info-item {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      padding: 12px;
      background: #f8f9fa;
      border-radius: 8px;
    }
    
    .info-icon {
      width: 20px;
      height: 20px;
      margin-right: 12px;
      color: #666;
    }
    
    .info-text {
      color: #333;
      font-size: 14px;
    }
    
    .cuisine-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 8px;
    }
    
    .cuisine-tag {
      background: #e9ecef;
      color: #495057;
      padding: 6px 12px;
      border-radius: 16px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .legal-info {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 16px;
      margin-top: 16px;
    }
    
    .legal-info h4 {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }
    
    .legal-info p {
      font-size: 12px;
      color: #666;
      margin-bottom: 4px;
      line-height: 1.4;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–∏–∂–Ω–µ–π –ø–ª–∞—à–∫–∏ –∑–∞–∫–∞–∑–∞ */
    .checkout-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: white;
      border-top: 1px solid #e5e7eb;
      padding: 16px;
      z-index: 1000;
      display: none;
    }
    
    .checkout-content {
      max-width: 480px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }
    
    .cart-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .cart-count {
      background: #dc2626;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 600;
    }
    
    .total-price {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }
    
    .min-order-note {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
    
    .checkout-btn {
      background: #dc2626;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .checkout-btn:hover {
      background: #b91c1c;
      transform: translateY(-1px);
    }
    
    .checkout-btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
      transform: none;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –±–ª—é–¥ */
    .dish-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .dish-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .dish-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }
    
    .dish-content {
      padding: 16px;
    }
    
    .dish-name {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      line-height: 1.3;
    }
    
    .dish-description {
      font-size: 14px;
      color: #666;
      margin-bottom: 12px;
      line-height: 1.4;
    }
    
    .dish-price {
      font-size: 20px;
      font-weight: 700;
      color: #dc2626;
      margin-bottom: 16px;
    }
    
    .dish-controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .add-btn {
      background: #dc2626;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .add-btn:hover {
      background: #b91c1c;
      transform: translateY(-1px);
    }
    
    .qty-controls {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .qty-btn {
      width: 32px;
      height: 32px;
      border: 1px solid #e5e7eb;
      background: white;
      border-radius: 50%;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .qty-btn:hover {
      background: #f3f4f6;
      border-color: #d1d5db;
    }
    
    .qty-display {
      font-size: 18px;
      font-weight: 600;
      color: #333;
      min-width: 30px;
      text-align: center;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ç–µ–≥–æ—Ä–∏–π –±–ª—é–¥ */
    .category-section {
      margin-bottom: 32px;
    }
    
    .category-title {
      font-size: 24px;
      font-weight: 700;
      color: #333;
      margin: 24px 12px 16px;
      padding-left: 8px;
      border-left: 4px solid #dc2626;
    }
    
    .dishes-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 0 12px;
      width: 100%;
      box-sizing: border-box;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ - –≤—Å–µ–≥–¥–∞ 2 –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Å—Ç—Ä–æ–∫–µ */
    @media (max-width: 600px) {
      .dishes-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        padding: 0 8px;
      }
    }
    
    @media (max-width: 480px) {
      .dishes-grid {
        grid-template-columns: repeat(2, 1fr); /* –í—Å–µ–≥–¥–∞ 2 –∫–∞—Ä—Ç–æ—á–∫–∏ */
        gap: 6px;
        padding: 0 6px;
      }
      
      .dish-card {
        border-radius: 8px;
      }
      
      .dish-content {
        padding: 8px;
      }
      
      .dish-name {
        font-size: 14px;
        line-height: 1.2;
      }
      
      .dish-description {
        font-size: 12px;
        margin-bottom: 8px;
      }
      
      .dish-price {
        font-size: 16px;
        margin-bottom: 8px;
      }
      
      .add-btn {
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .qty-btn {
        width: 28px;
        height: 28px;
        font-size: 16px;
      }
      
      .qty-display {
        font-size: 16px;
      }
    }
    
    /* –î–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
    @media (max-width: 360px) {
      .dishes-grid {
        gap: 4px;
        padding: 0 4px;
      }
      
      .dish-content {
        padding: 6px;
      }
      
      .dish-name {
        font-size: 13px;
      }
      
      .dish-description {
        font-size: 11px;
        margin-bottom: 6px;
      }
      
      .dish-price {
        font-size: 14px;
        margin-bottom: 6px;
      }
      
      .add-btn {
        padding: 6px 10px;
        font-size: 11px;
      }
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥ */
    .back-button-container {
      position: sticky;
      top: 0;
      z-index: 200;
      background: #f8fafc;
      padding: 16px 16px 8px;
      margin-bottom: 0;
    }
    
    .back-btn {
      background: #fff;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 14px;
      color: #333;
      cursor: pointer;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .back-btn:hover {
      background: #f8f8f8;
      border-color: #d0d0d0;
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ */
    .restaurant-header {
      padding: 16px 16px 0;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      position: relative;
      z-index: 100;
    }
    
    .restaurant-info {
      flex: 1;
      display: block !important;
    }
    
    .restaurant-info h1 {
      font-size: 24px;
      font-weight: 600;
      margin: 0 0 8px 0;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .restaurant-details-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
      width: 100%;
    }
    
    .rating-section {
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .rating-section span:first-child {
      font-weight: 600;
      color: #333;
    }
    
    .rating-section span:last-child {
      color: #666;
      font-size: 14px;
    }
    
    .delivery-section {
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .delivery-icon {
      font-size: 16px;
    }
    
    .delivery-section span:last-child {
      color: #666;
      font-size: 14px;
    }
    
    .info-btn {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid #e5e5e5;
      font-size: 20px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      transition: all 0.2s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      z-index: 250;
      position: relative;
    }
    
    .info-btn:hover {
      background-color: #f8f8f8;
      border-color: #d0d0d0;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –±–ª—é–¥–∞–º–∏ */
    #dishesGrid {
      padding-top: 8px; /* –ù–µ–±–æ–ª—å—à–æ–π –æ—Ç—Å—Ç—É–ø –æ—Ç –ø–ª–∞—à–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π */
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–µ–π—Å–µ—Ä–∞ –≤–Ω–∏–∑—É */
    .bottom-spacer {
      height: 80px;
      transition: height 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ -->
    <div class="back-button-container">
      <button class="back-btn" onclick="goBack()">‚Üê –ù–∞–∑–∞–¥</button>
    </div>
    
    <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ -->
    <div class="restaurant-header">
      <div class="restaurant-info">
        <h1 id="restaurantName">–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
        <div class="restaurant-details-row">
          <div class="rating-section clickable-rating" onclick="showReviewsModal()">
            <span id="restaurantRating">‚òÖ --</span>
      <span class="reviews-arrow">‚Üí</span>
            <span id="restaurantReviews">-- –æ—Ç–∑—ã–≤–æ–≤</span>
          </div>
          <div class="delivery-section">
            <span class="delivery-icon">üöö</span>
            <span id="restaurantDelivery">-- –º–∏–Ω</span>
          </div>
        </div>
      </div>
      <button class="info-btn" onclick="showRestaurantInfo()">‚ÑπÔ∏è</button>
    </div>
    
    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–ª—é–¥ -->
    <div class="cat-row" id="categoriesRow"></div>
    
    <!-- –°–µ—Ç–∫–∞ –±–ª—é–¥ -->
    <div id="dishesGrid"></div>
    
    <!-- –°–ø–µ–π—Å–µ—Ä –¥–ª—è –Ω–∏–∂–Ω–µ–π –ø–ª–∞—à–∫–∏ -->
    <div id="bottomSpacer" class="bottom-spacer"></div>
    
    <!-- –ù–∏–∂–Ω—è—è –ø–ª–∞—à–∫–∞ –∑–∞–∫–∞–∑–∞ -->
    <div class="checkout-bar" id="checkoutBar">
      <div class="checkout-content">
        <div class="cart-info">
          <div class="cart-count" id="cartCount">0</div>
          <div>
            <div class="total-price" id="totalPriceBottom">0 ‚ÇΩ</div>
            <div class="min-order-note" id="minOrderText"></div>
          </div>
        </div>
        <button class="checkout-btn" id="goCheckout" onclick="proceedToCheckout()">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
      </div>
    </div>
  </div>
  
  <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ -->
  <div class="restaurant-info-modal" id="restaurantInfoModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ</h2>
        <button class="close-modal" id="closeModal">√ó</button>
      </div>
      <div class="modal-body">
        <div class="info-section">
          <h3>–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
          <div class="info-item">
            <span class="info-icon">üìç</span>
            <span class="info-text" id="modalAddress">–ê–¥—Ä–µ—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>
          </div>
          <div class="info-item">
            <span class="info-icon">üìû</span>
            <span class="info-text" id="modalPhone">–¢–µ–ª–µ—Ñ–æ–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>
          </div>
          <div class="info-item">
            <span class="info-icon">üïí</span>
            <span class="info-text" id="modalWorkingHours">–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>
          </div>
          <div class="info-item">
            <span class="info-icon">‚≠ê</span>
            <span class="info-text" id="modalRating">–†–µ–π—Ç–∏–Ω–≥ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</span>
          </div>
        </div>
        
        <div class="info-section">
          <h3>–ö—É—Ö–Ω—è</h3>
          <div class="cuisine-tags" id="modalCuisine">
            <!-- –¢–µ–≥–∏ –∫—É—Ö–Ω–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
          </div>
        </div>
        
        <div class="legal-info">
          <h4>–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
          <p id="modalLegalName">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
          <p id="modalLegalAddress">–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>
      <p id="modalLegalDetails">–†–µ–∫–≤–∏–∑–∏—Ç—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...</p>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤ -->
<div class="restaurant-info-modal" id="reviewsModal">
  <div class="modal-content">
    <div class="modal-header">
      <h2 class="modal-title">–û—Ç–∑—ã–≤—ã –æ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ</h2>
      <button class="close-modal" id="closeReviewsModal">√ó</button>
    </div>
    <div class="modal-body">
      <div id="reviewsList">
        <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤...</div>
      </div>
    </div>
  </div>
</div>
  </div>
  
  <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
  <div class="nav-container">
    <a id="navHome" href="#" class="nav-item">
      <span class="nav-icon nav-icon-home"></span>
      <span>–ì–ª–∞–≤–Ω–æ–µ</span>
    </a>
    <span class="nav-item disabled">
      <span class="nav-icon nav-icon-promo"></span>
      <span>–ê–∫—Ü–∏–∏</span>
    </span>
    <a id="navCart" href="#" class="nav-item">
      <span class="nav-icon nav-icon-cart"></span>
      <span>–ö–æ—Ä–∑–∏–Ω–∞</span>
    </a>
    <a id="navMenu" href="#" class="nav-item">
      <span class="nav-icon nav-icon-menu"></span>
      <span>–ú–µ–Ω—é</span>
    </a>
    <a id="navProfile" href="#" class="nav-item">
      <span class="nav-icon nav-icon-profile"></span>
      <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
    </a>
  </div>
  
  <script>
    const api = location.origin + '/api';
    const tg = window.Telegram?.WebApp;
    const q = new URLSearchParams(location.search);
    const uid = (q.get('uid') && Number(q.get('uid'))) || tg?.initDataUnsafe?.user?.id || 0;
    const headers = uid ? { 'X-Telegram-User-Id': String(uid) } : {};
    
    let restaurantId = Number(q.get('id')) || 0;
    let categories = [];
    let dishes = [];
    let cart = { items: [] };
    let dishesMap = new Map();
    let restaurantsMap = new Map();
    let activeCategory = null;
    let scrollPosition = 0; // –ü–æ–∑–∏—Ü–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
    
    async function loadMenu() {
      try {
        const [catRes, dishRes, restRes] = await Promise.all([
          fetch(api + '/categories?restaurant_id=' + restaurantId + (uid ? ('&uid=' + uid) : ''), { headers }),
          fetch(api + '/dishes?restaurant_id=' + restaurantId + (uid ? ('&uid=' + uid) : ''), { headers }),
          fetch(api + '/restaurants/' + restaurantId + (uid ? ('?uid=' + uid) : ''), { headers })
        ]);
        
        categories = await catRes.json();
        dishes = await dishRes.json();
        const restaurant = await restRes.json();
        
        restaurantsMap.set(restaurant.id, restaurant);
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∫–∞—Ä—Ç—É –±–ª—é–¥
        dishes.forEach(dish => {
          dishesMap.set(dish.id, dish);
        });
        
        await renderRestaurantHeader(restaurant);
        renderCategories();
        renderDishes();
        
      } catch (error) {
        console.error('Error loading menu:', error);
      }
    }
    
    async function renderRestaurantHeader(restaurant) {
      document.getElementById('restaurantName').textContent = restaurant.name;
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–π—Ç–∏–Ω–≥
      const rating = restaurant.rating_agg 
        ? `‚òÖ ${Number(restaurant.rating_agg).toFixed(1)}`
        : '‚òÖ --';
      document.getElementById('restaurantRating').textContent = rating;
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤ –∏–∑ API
      try {
        // console.log('Loading reviews for restaurant ID:', restaurant.id);
        const reviewsRes = await fetch(api + '/reviews/restaurant/' + restaurant.id);
        // console.log('Reviews API response:', reviewsRes.status, reviewsRes.ok);
        if (reviewsRes.ok) {
          const reviewsData = await reviewsRes.json();
          // console.log('Reviews data:', reviewsData);
          const reviewsCount = reviewsData.total_reviews || 0;
          // console.log('Reviews count:', reviewsCount);
          document.getElementById('restaurantReviews').textContent = `${reviewsCount} –æ—Ç–∑—ã–≤–æ–≤`;
        } else {
          // console.log('Reviews API failed, using fallback');
          document.getElementById('restaurantReviews').textContent = '0 –æ—Ç–∑—ã–≤–æ–≤';
        }
      } catch (error) {
        console.error('Error loading reviews count:', error);
        document.getElementById('restaurantReviews').textContent = '0 –æ—Ç–∑—ã–≤–æ–≤';
      }
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏
      const deliveryTime = restaurant.delivery_time_min && restaurant.delivery_time_max
        ? `${restaurant.delivery_time_min}‚Äì${restaurant.delivery_time_max} –º–∏–Ω`
        : restaurant.delivery_time_minutes 
          ? `${restaurant.delivery_time_minutes} –º–∏–Ω`
          : '-- –º–∏–Ω';
      document.getElementById('restaurantDelivery').textContent = deliveryTime;
    }
    
    function renderCategories() {
      const row = document.getElementById('categoriesRow');
      row.innerHTML = '';
      
      categories.forEach(category => {
        const button = document.createElement('button');
        button.textContent = category.name;
        button.onclick = () => {
          activeCategory = category.id;
          updateActiveCategory();
          scrollToCategory(category.id);
        };
        row.appendChild(button);
      });
      
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      if (categories.length > 0) {
        activeCategory = categories[0].id;
        updateActiveCategory();
      }
    }
    
    function updateActiveCategory() {
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é –≤ –∫–Ω–æ–ø–∫–∞—Ö
      document.querySelectorAll('.cat-row button').forEach(btn => {
        btn.classList.remove('active');
      });
      
      if (activeCategory) {
        const activeBtn = Array.from(document.querySelectorAll('.cat-row button')).find(btn => {
          const category = categories.find(c => c.name === btn.textContent);
          return category && category.id === activeCategory;
        });
        if (activeBtn) activeBtn.classList.add('active');
      }
    }
    
    function scrollToCategory(categoryId) {
      const categoryElement = document.querySelector(`[data-category="${categoryId}"]`);
      if (categoryElement) {
        categoryElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    }
    
    function renderDishes() {
      const grid = document.getElementById('dishesGrid');
      grid.innerHTML = '';
      
      // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –±–ª—é–¥–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
      const dishesByCategory = {};
      dishes.forEach(dish => {
        if (!dishesByCategory[dish.category_id]) {
          dishesByCategory[dish.category_id] = [];
        }
        dishesByCategory[dish.category_id].push(dish);
      });
      
      // –†–µ–Ω–¥–µ—Ä–∏–º –∫–∞–∂–¥—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
      categories.forEach(category => {
        const categoryDishes = dishesByCategory[category.id] || [];
        if (categoryDishes.length === 0) return;
        
        const categoryContainer = document.createElement('div');
        categoryContainer.className = 'category-section';
        categoryContainer.setAttribute('data-category', category.id);
        
        const categoryTitle = document.createElement('h2');
        categoryTitle.className = 'category-title';
        categoryTitle.textContent = category.name;
        categoryContainer.appendChild(categoryTitle);
        
        const dishesGrid = document.createElement('div');
        dishesGrid.className = 'dishes-grid';
        
        categoryDishes.forEach((dish, index) => {
          const card = document.createElement('div');
          card.className = 'dish-card';
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –ø–æ—è–≤–ª–µ–Ω–∏—è
          card.style.animationDelay = `${index * 0.1}s`;
          
          card.innerHTML = `
            ${dish.image ? `<img src="${dish.image}" alt="${dish.name}" class="dish-image" />` : ''}
            <div class="dish-content">
              <h3 class="dish-name">${dish.name}</h3>
              <p class="dish-description">${dish.description || '–û–ø–∏—Å–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}</p>
              <div class="dish-price">${dish.price || 0} ‚ÇΩ</div>
              <div class="dish-controls">
                <div class="controls" data-dish="${dish.id}" data-category="${dish.category_id}">
                  <button class="add-btn">+</button>
                </div>
              </div>
            </div>
          `;
          
          // –î–µ–ª–∞–µ–º –≤—Å—é –∫–∞—Ä—Ç–æ—á–∫—É –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ–π –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –±–ª—é–¥—É
          card.onclick = (e) => {
            // –ï—Å–ª–∏ –∫–ª–∏–∫–Ω—É–ª–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º, –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –±–ª—é–¥—É
            if (e.target.closest('.add-btn') || e.target.closest('.qty-btn')) {
              return;
            }
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –±–ª—é–¥—É
            saveScrollPosition();
            
            const p = new URLSearchParams(location.search);
            if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning','1');
            p.set('category_id', dish.category_id);
            p.set('scroll_position', scrollPosition.toString());
            location.href = '/static/dish.html?id=' + dish.id + '&' + p.toString();
          };
          
          const controls = card.querySelector('.controls');
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ renderQtyControls
          dishesGrid.appendChild(card);
        });
        
        categoryContainer.appendChild(dishesGrid);
        grid.appendChild(categoryContainer);
      });
      
      loadCartAndSync();
      
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∏–∑ –±–ª—é–¥–∞
      const urlParams = new URLSearchParams(location.search);
      const savedScrollPosition = Number(urlParams.get('scroll_position')) || 0;
      const fromPage = urlParams.get('from');
      
      if (savedScrollPosition > 0 && fromPage === 'dish') {
        // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
        setTimeout(() => {
          window.scrollTo(0, savedScrollPosition);
          console.log('Restored scroll position after content load:', savedScrollPosition);
        }, 100);
      }
    }
    
    async function addToCart(dishId, deltaQty) {
      const dish = dishesMap.get(dishId);
      
      const cartData = { 
        restaurant_id: dish.restaurant_id, 
        dish_id: dish.id, 
        qty: deltaQty,
        chosen_options: [] // –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ –¥–ª—è –±–ª—é–¥ –±–µ–∑ –æ–ø—Ü–∏–π
      };
      
      const res = await fetch(location.origin + '/api/cart/items' + (uid ? ('?uid=' + uid) : ''), {
        method: 'POST',
        headers: {
          ...headers,
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(cartData)
      });
      
      // console.log('Response status:', res.status);
      
      if (!res.ok) {
        const errorText = await res.text();
        console.error('Error response:', errorText);
        throw new Error(`HTTP ${res.status}: ${errorText}`);
      }
      
      const data = await res.json();
      // console.log('Response data:', data);
      
      if (data.status === 'too_many_restaurants') {
        showTooManyModal(data.current_restaurant_ids || [], async () => {
          await fetch(location.origin + '/api/cart/items?force=true' + (uid ? ('&uid=' + uid) : ''), { 
            method: 'POST', 
            headers: {
              ...headers,
              'Content-Type': 'application/json'
            }, 
            body: JSON.stringify(cartData) 
          });
          await loadCartAndSync();
        });
      } else {
        await loadCartAndSync();
      }
    }
    
    async function loadCartAndSync() {
      const res = await fetch(api + '/cart' + (uid ? ('?uid=' + uid) : ''), { headers });
      cart = await res.json();
      clearQtyCache(); // –û—á–∏—â–∞–µ–º –∫—ç—à –ø–µ—Ä–µ–¥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º
      renderQtyControls();
      updateOrderSummary(); // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –Ω–∏–∂–Ω–µ–π –ø–ª–∞—à–∫–µ
    }
    
    // –ö—ç—à –¥–ª—è –∫–æ–ª–∏—á–µ—Å—Ç–≤ –±–ª—é–¥
    let qtyCache = new Map();
    
    function getQtyForDish(dishId) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
      if (qtyCache.has(dishId)) {
        return qtyCache.get(dishId);
      }
      
      const qty = cart.items.filter(i => i.dish_id === dishId && dishesMap.get(i.dish_id)?.restaurant_id === restaurantId)
        .reduce((s, i) => s + i.qty, 0);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à
      qtyCache.set(dishId, qty);
      return qty;
    }
    
    // –û—á–∏—â–∞–µ–º –∫—ç—à –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ—Ä–∑–∏–Ω—ã
    function clearQtyCache() {
      qtyCache.clear();
    }
    
    function renderQtyControls() {
      // –ö—ç—à–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
      const controls = document.querySelectorAll('.controls');
      if (controls.length === 0) return; // –ï—Å–ª–∏ –Ω–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –≤—ã—Ö–æ–¥–∏–º
      
      controls.forEach(c => {
        const dishId = Number(c.getAttribute('data-dish'));
        const dish = dishesMap.get(dishId);
        const qty = getQtyForDish(dishId);
        // console.log('DEBUG: renderQtyControls - dishId:', dishId, 'dish:', dish, 'has_options:', dish?.has_options, 'qty:', qty);
        
        if (qty <= 0) {
          // –ö–Ω–æ–ø–∫–∞ "+" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–ª—é–¥–∞
          c.innerHTML = '<button class="add-btn">+</button>';
          const addBtn = c.querySelector('.add-btn');
          addBtn.onclick = () => {
            // –ï—Å–ª–∏ —É –±–ª—é–¥–∞ –µ—Å—Ç—å –æ–ø—Ü–∏–∏, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–ª—é–¥–∞
            if (dish?.has_options) {
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –±–ª—é–¥—É
              saveScrollPosition();
              
              const p = new URLSearchParams(location.search);
              if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning','1');
              const categoryId = c.getAttribute('data-category');
        p.set('category_id', categoryId);
        p.set('scroll_position', scrollPosition.toString());
        location.href = '/static/dish.html?id=' + dishId + '&' + p.toString();
              return;
            }
            // –ï—Å–ª–∏ –æ–ø—Ü–∏–π –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
            addBtn.classList.add('success-animation');
            setTimeout(() => {
              addBtn.classList.remove('success-animation');
            }, 600);
            updateQtyClient(dishId, 1);
          };
        } else {
          // –ö–æ–Ω—Ç—Ä–æ–ª—ã —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º: "-" –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ "+"
          c.innerHTML = `
            <div class="qty-controls">
              <button class="qty-btn" data-act="dec" title="–£–º–µ–Ω—å—à–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">‚àí</button>
              <span class="qty-display">${qty}</span>
              <button class="qty-btn" data-act="inc" title="–£–≤–µ–ª–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ">+</button>
            </div>
          `;
          
          // –î–æ–±–∞–≤–ª—è–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–æ–≤
          c.style.animation = 'fadeInUp 0.3s ease-out';
          
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "-"
          c.querySelector('[data-act="dec"]').onclick = () => updateQtyClient(dishId, -1);
          
          // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "+"
          c.querySelector('[data-act="inc"]').onclick = () => {
            // console.log('DEBUG: renderQtyControls + button clicked - dishId:', dishId, 'dish:', dish, 'has_options:', dish?.has_options);
            // –ï—Å–ª–∏ —É –±–ª—é–¥–∞ –µ—Å—Ç—å –æ–ø—Ü–∏–∏, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –±–ª—é–¥–∞
            if (dish?.has_options) {
              // console.log('DEBUG: Redirecting to dish page for options');
              // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ –±–ª—é–¥—É
              saveScrollPosition();
              
              const p = new URLSearchParams(location.search);
              if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning','1');
              const categoryId = c.getAttribute('data-category');
        p.set('category_id', categoryId);
        p.set('scroll_position', scrollPosition.toString());
        location.href = '/static/dish.html?id=' + dishId + '&' + p.toString();
              return;
            }
            // console.log('DEBUG: Adding to cart directly');
            // –ï—Å–ª–∏ –æ–ø—Ü–∏–π –Ω–µ—Ç, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ—Ä–∑–∏–Ω—É
            updateQtyClient(dishId, 1);
          };
        }
      });
    }
    
    async function updateQtyClient(dishId, delta) {
      if (delta > 0) {
        // console.log('DEBUG: Adding to cart directly');
        await addToCart(dishId, 1);
      } else {
        const item = cart.items.find(i => i.dish_id === dishId && dishesMap.get(i.dish_id)?.restaurant_id === restaurantId);
        if (item) {
          const newQty = Math.max(0, item.qty - 1);
          if (newQty === 0) {
            await fetch(api + '/cart/items/' + item.id + (uid ? ('?uid=' + uid) : ''), { method: 'DELETE', headers });
          } else {
            await fetch(api + '/cart/items/' + item.id + '?qty=' + newQty + (uid ? ('&uid=' + uid) : ''), { method: 'PATCH', headers });
          }
          await loadCartAndSync();
        }
      }
    }
    
    function calcTotalForRestaurant() {
      return cart.items.reduce((sum, it) => {
        const d = dishesMap.get(it.dish_id);
        if (!d || d.restaurant_id !== restaurantId) return sum;
        return sum + (d.price || 0) * it.qty;
      }, 0);
    }
    
    function updateOrderSummary() {
      const sum = calcTotalForRestaurant();
      const totalItems = cart.items.filter(i => {
        const d = dishesMap.get(i.dish_id);
        return d && d.restaurant_id === restaurantId;
      }).reduce((s, i) => s + i.qty, 0);
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
      document.getElementById('cartCount').textContent = totalItems;
      document.getElementById('totalPriceBottom').textContent = sum + ' ‚ÇΩ';
      
      // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –∏–∑ –¥–∞–Ω–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
      const r = restaurantsMap.get(restaurantId);
      const checkoutBtn = document.getElementById('goCheckout');
      
      if (r && r.delivery_min_sum && r.delivery_min_sum > 0) {
        const remaining = Math.max(0, r.delivery_min_sum - sum);
        if (remaining > 0) {
          document.getElementById('minOrderText').textContent = `–ï—â–µ ${remaining} ‚ÇΩ –¥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞`;
          checkoutBtn.disabled = true;
          checkoutBtn.textContent = `–î–æ–±–∞–≤—å—Ç–µ –µ—â–µ –Ω–∞ ${remaining} ‚ÇΩ`;
          checkoutBtn.className = 'checkout-btn disabled';
        } else {
          document.getElementById('minOrderText').textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞';
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑';
          checkoutBtn.className = 'checkout-btn';
        }
      } else {
        // –ó–∞–≥–ª—É—à–∫–∞ –µ—Å–ª–∏ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–µ
        const minOrder = 1000;
        const remaining = Math.max(0, minOrder - sum);
        if (remaining > 0) {
          document.getElementById('minOrderText').textContent = `–ï—â–µ ${remaining} ‚ÇΩ –¥–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ –∑–∞–∫–∞–∑–∞`;
          checkoutBtn.disabled = true;
          checkoutBtn.textContent = `–î–æ–±–∞–≤—å—Ç–µ –µ—â–µ –Ω–∞ ${remaining} ‚ÇΩ`;
          checkoutBtn.className = 'checkout-btn disabled';
        } else {
          document.getElementById('minOrderText').textContent = '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞';
          checkoutBtn.disabled = false;
          checkoutBtn.textContent = '–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑';
          checkoutBtn.className = 'checkout-btn';
        }
      }
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –Ω–∏–∂–Ω—é—é –ø–ª–∞—à–∫—É
      const checkoutBar = document.getElementById('checkoutBar');
      const bottomSpacer = document.getElementById('bottomSpacer');
      
      if (sum > 0) {
        checkoutBar.style.display = 'block';
        bottomSpacer.style.height = '80px';
      } else {
        checkoutBar.style.display = 'none';
        bottomSpacer.style.height = '0px';
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞
    function proceedToCheckout() {
      const p = new URLSearchParams(location.search);
      if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1');
      p.set('r', String(restaurantId));
      location.href = '/static/cart.html?' + p.toString();
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
    function showRestaurantInfo() {
      const restaurant = restaurantsMap.get(restaurantId);
      if (!restaurant) return;
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
      document.getElementById('modalAddress').textContent = restaurant.address || '–ê–¥—Ä–µ—Å –Ω–µ —É–∫–∞–∑–∞–Ω';
      document.getElementById('modalPhone').textContent = restaurant.phone || '–¢–µ–ª–µ—Ñ–æ–Ω –Ω–µ —É–∫–∞–∑–∞–Ω';
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∂–∏–º–µ —Ä–∞–±–æ—Ç—ã
      const workingHours = restaurant.work_open_min !== undefined && restaurant.work_close_min !== undefined 
        ? `–†–∞–±–æ—Ç–∞–µ–º —Å ${formatTime(restaurant.work_open_min)} –¥–æ ${formatTime(restaurant.work_close_min)}`
        : '–†–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ';
      document.getElementById('modalWorkingHours').textContent = workingHours;
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º —Ä–µ–π—Ç–∏–Ω–≥
      const rating = restaurant.rating_agg 
        ? `‚òÖ ${Number(restaurant.rating_agg).toFixed(1)}`
        : '‚òÖ --';
      document.getElementById('modalRating').textContent = rating;
      
      // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–≥–∏ –∫—É—Ö–Ω–∏ (–∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
      const cuisineTags = ['–ê–º–µ—Ä–∏–∫–∞–Ω—Å–∫–∞—è', '–ë—É—Ä–≥–µ—Ä—ã', '–ó–∞–≤—Ç—Ä–∞–∫–∏', '–ö–æ—Ñ–µ', '–§–∞—Å—Ç—Ñ—É–¥', '–î–µ—Å–µ—Ä—Ç—ã'];
      const cuisineContainer = document.getElementById('modalCuisine');
      cuisineContainer.innerHTML = '';
      cuisineTags.forEach(tag => {
        const tagElement = document.createElement('span');
        tagElement.className = 'cuisine-tag';
        tagElement.textContent = tag;
        cuisineContainer.appendChild(tagElement);
      });
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º —é—Ä–∏–¥–∏—á–µ—Å–∫—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é (–∑–∞–≥–ª—É—à–∫–∏, —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –Ω–µ—Ç —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö)
      document.getElementById('modalLegalName').textContent = '–û–û–û "–°–∏—Å—Ç–µ–º–∞ –ü–ë–û"';
      document.getElementById('modalLegalAddress').textContent = '115054, –†–æ—Å—Å–∏—è, –≥. –ú–æ—Å–∫–≤–∞, –í–∞–ª–æ–≤–∞—è, –¥–æ–º 26';
      document.getElementById('modalLegalDetails').textContent = '–ò–ù–ù 7710044140, —Ä–µ–≥. –Ω–æ–º–µ—Ä 1027700251754';
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
      const modal = document.getElementById('restaurantInfoModal');
      modal.classList.add('show');
      
      // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          hideRestaurantInfo();
        }
      });
    }
    
    function hideRestaurantInfo() {
      const modal = document.getElementById('restaurantInfoModal');
      modal.classList.remove('show');
    }
    
    function formatTime(minutes) {
      const hours = Math.floor(minutes / 60);
      const mins = minutes % 60;
      return `${hours.toString().padStart(2, '0')}:${mins.toString().padStart(2, '0')}`;
    }
    
    // Modal for too many restaurants
    function ensureOverlay() {
      let ov = document.getElementById('ov');
      if (!ov) {
        ov = document.createElement('div');
        ov.id = 'ov';
        ov.className = 'overlay';
        ov.innerHTML = '<div class="modal"><h3>–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –∫–æ—Ä–∑–∏–Ω</h3><div class="muted">–£–¥–∞–ª–∏—Ç–µ –∫–æ—Ä–∑–∏–Ω—É, —á—Ç–æ–±—ã —Å–æ–±—Ä–∞—Ç—å –Ω–æ–≤—É—é</div><div id="ovList"></div><div style="margin-top:10px;text-align:right"><button id="ovDone" class="primary">–ì–æ—Ç–æ–≤–æ</button></div></div>';
        document.body.appendChild(ov);
      }
      return ov;
    }
    
    async function showTooManyModal(restIds, onDone) {
      const ov = ensureOverlay();
      const list = ov.querySelector('#ovList');
      list.innerHTML = '';
      
      // Load names
      const resR = await fetch(api + '/restaurants/_bulk?ids=' + encodeURIComponent(restIds.join(',')) + (uid ? ('&uid=' + uid) : ''), { headers });
      const rests = resR.ok ? await resR.json() : [];
      rests.forEach(r => {
        const row = document.createElement('div');
        row.className = 'row';
        row.innerHTML = `<div>${r.name}</div><button class="trash">üóë</button>`;
        row.querySelector('.trash').onclick = async () => {
          await fetch(api + '/cart/clear?restaurant_id=' + r.id + (uid ? ('&uid=' + uid) : ''), { method: 'POST', headers });
          row.remove();
        };
        list.appendChild(row);
      });
      ov.style.display = 'flex';
      ov.querySelector('#ovDone').onclick = async () => {
        ov.style.display = 'none';
        if (onDone) await onDone();
      };
    }
    
    // Navigation
    document.getElementById('navHome').onclick = (e) => { 
      e.preventDefault(); 
      const p = new URLSearchParams(location.search); 
      if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1'); 
      location.href = '/static/index.html?' + p.toString(); 
    };
    
    document.getElementById('navCart').onclick = (e) => { 
      e.preventDefault(); 
      const p = new URLSearchParams(location.search); 
      if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1'); 
      location.href = '/static/cart.html?' + p.toString(); 
    };
    
    document.getElementById('navProfile').onclick = (e) => { 
      e.preventDefault(); 
      const p = new URLSearchParams(location.search); 
      if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1'); 
      location.href = '/static/profile.html?' + p.toString(); 
    };
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–∑–∏—Ü–∏–µ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    function saveScrollPosition() {
      scrollPosition = window.pageYOffset || document.documentElement.scrollTop;
      console.log('Saved scroll position:', scrollPosition);
    }
    
    function restoreScrollPosition() {
      if (scrollPosition > 0) {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤—ã—Å–æ—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞
        const pageHeight = Math.max(
          document.body.scrollHeight,
          document.body.offsetHeight,
          document.documentElement.clientHeight,
          document.documentElement.scrollHeight,
          document.documentElement.offsetHeight
        );
        
        if (pageHeight > scrollPosition) {
          window.scrollTo(0, scrollPosition);
          console.log('Restored scroll position:', scrollPosition);
        } else {
          console.log('Page height too small for scroll position:', pageHeight, 'vs', scrollPosition);
        }
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –Ω–∞–∑–∞–¥
    function goBack() {
      console.log('=== goBack called ===');
      
      // –ü–æ–ª—É—á–∞–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—É—é –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ –∏–∑ URL (–∫–æ—Ç–æ—Ä–∞—è –±—ã–ª–∞ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
      const originalScrollPosition = Number(q.get('scroll_position')) || 0;
      console.log('Original scroll position from URL:', originalScrollPosition);
      
      // –†–µ—Å—Ç–æ—Ä–∞–Ω ‚Üí –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–π –ø–æ–∑–∏—Ü–∏–µ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
      const params = new URLSearchParams(location.search);
      if (!params.get('ngrok-skip-browser-warning')) params.set('ngrok-skip-browser-warning', '1');
      params.set('scroll_position', originalScrollPosition.toString());
      
      // –û—á–∏—â–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω—ã –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
      params.delete('id');
      params.delete('category_id');
      params.delete('scroll_to_category');
      
      const finalUrl = '/static/index.html?' + params.toString();
      console.log('Final URL:', finalUrl);
      console.log('URL params:', params.toString());
      console.log('Redirecting to index.html with original scroll_position:', originalScrollPosition);
      
      location.href = finalUrl;
    }
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–æ –ª–∏ —Å–∫—Ä–æ–ª–ª–∏—Ç—å –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
    const urlParams = new URLSearchParams(location.search);
    
    // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –±–ª—é–¥–∞
    const savedScrollPosition = Number(urlParams.get('scroll_position')) || 0;
    const fromPage = urlParams.get('from');
    
    console.log('From page:', fromPage, 'Saved scroll position:', savedScrollPosition);
    
    if (savedScrollPosition > 0 && fromPage === 'dish') {
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ restoreScrollPosition
      scrollPosition = savedScrollPosition;
      console.log('Scroll position changed to:', savedScrollPosition);
      
      // –°—Ä–∞–∑—É —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
      window.scrollTo(0, savedScrollPosition);
      console.log('Immediate scroll to position:', savedScrollPosition);
    } else if (fromPage === 'index') {
      console.log('Transition from index page - no scroll restoration needed');
    }
    
    // Primary initialization
    loadMenu();
    
    const scrollToCategoryId = urlParams.get('scroll_to_category');
    if (scrollToCategoryId) {
      // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ–Ω—é –∏ —Å–∫—Ä–æ–ª–ª–∏–º –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      setTimeout(() => {
        scrollToCategory(scrollToCategoryId);
      }, 100);
    }
    
    // Add scroll handler for updating active category
    window.addEventListener('scroll', updateActiveCategory);
    
    // Modal close handler
    document.getElementById('closeModal').onclick = hideRestaurantInfo;
    document.getElementById('closeReviewsModal').onclick = hideReviewsModal;
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–≤–∞–π–ø –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    initSwipe();
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–∑—ã–≤–∞–º–∏
    async function showReviewsModal() {
      console.log('Opening reviews modal...');
      
      // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
      const existingModal = document.getElementById('reviewsModal');
      if (existingModal) {
        existingModal.remove();
      }
      
      const modal = document.createElement('div');
      modal.id = 'reviewsModal';
      modal.className = 'restaurant-info-modal show';
      modal.style.cssText = `
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 100vh !important;
        background: rgba(0, 0, 0, 0.5) !important;
        z-index: 1001 !important;
        display: block !important;
        opacity: 1 !important;
        visibility: visible !important;
      `;
      
      const modalContent = document.createElement('div');
      modalContent.className = 'modal-content';
      modalContent.style.cssText = `
        position: fixed !important;
        bottom: 0 !important;
        left: 0 !important;
        width: 100vw !important;
        height: 80vh !important;
        background: #fff !important;
        border-radius: 20px 20px 0 0 !important;
        transform: translateY(0) !important;
        transition: transform 0.3s ease !important;
        overflow-y: auto !important;
        z-index: 1002 !important;
        min-height: 400px !important;
      `;
      
      modalContent.innerHTML = `
        <div class="modal-header">
          <button class="back-button" onclick="hideReviewsModal()">‚Üê</button>
          <h2 class="modal-title">–û—Ç–∑—ã–≤—ã</h2>
          <div class="header-spacer"></div>
        </div>
        <div class="modal-body">
          <div id="reviewsList">
            <div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤...</div>
          </div>
        </div>
      `;
      
      modal.appendChild(modalContent);
      document.body.appendChild(modal);
      
      console.log('Modal created and added to DOM');
      console.log('Modal dimensions:', modal.offsetWidth, 'x', modal.offsetHeight);
      console.log('Modal content dimensions:', modalContent.offsetWidth, 'x', modalContent.offsetHeight);
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç–∑—ã–≤—ã
      try {
        const reviewsList = document.getElementById('reviewsList');
        reviewsList.innerHTML = '<div class="loading-text">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–∑—ã–≤–æ–≤...</div>';
        
        const response = await fetch(api + '/reviews/restaurant/' + restaurantId);
        if (response.ok) {
          const data = await response.json();
          displayReviews(data.reviews || []);
        } else {
          reviewsList.innerHTML = '<div class="no-reviews">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤</div>';
        }
      } catch (error) {
        console.error('Error loading reviews:', error);
        reviewsList.innerHTML = '<div class="no-reviews">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∑—ã–≤–æ–≤</div>';
      }
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          hideReviewsModal();
        }
      });
    }
    
    function hideReviewsModal() {
      const modal = document.getElementById('reviewsModal');
      if (modal) {
        modal.remove();
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã
    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      if (diffDays === 1) {
        return `–í—á–µ—Ä–∞ –≤ ${date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}`;
      } else if (diffDays === 2) {
        return `–ü–æ–∑–∞–≤—á–µ—Ä–∞ –≤ ${date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}`;
      } else if (diffDays <= 7) {
        return `${diffDays} –¥–Ω. –Ω–∞–∑–∞–¥ –≤ ${date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}`;
      } else {
        return `${date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'short' })} –≤ ${date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })}`;
      }
    }
    
    function displayReviews(reviews) {
      const reviewsList = document.getElementById('reviewsList');
      
      if (reviews.length === 0) {
        reviewsList.innerHTML = '<div class="no-reviews">–ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–∑—ã–≤–æ–≤ –æ —ç—Ç–æ–º —Ä–µ—Å—Ç–æ—Ä–∞–Ω–µ</div>';
        return;
      }
      
      reviewsList.innerHTML = reviews.map(review => `
        <div class="review-item">
          <div class="review-header">
            <div class="reviewer-info">
              <div class="thumbs-up-icon"></div>
              <span class="reviewer-name">${review.user_name || '–ê–Ω–æ–Ω–∏–º'}</span>
            </div>
            <span class="review-date">${formatDate(review.created_at)}</span>
          </div>
          <div class="review-text">${review.comment || '–ë–µ–∑ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}</div>
          ${review.ordered_items ? `<div class="ordered-items">${review.ordered_items}</div>` : ''}
        </div>
      `).join('');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–≤–∞–π–ø–∞
    function initSwipe() {
      let startX = 0;
      let startY = 0;
      let currentX = 0;
      let isSwipeActive = false;
      let swipeThreshold = 0;
      const minSwipeDistance = 80; // –£–º–µ–Ω—å—à–µ–Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è
      const maxVerticalDistance = 80; // –£–≤–µ–ª–∏—á–µ–Ω–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ
      const swipeZone = 50; // –ó–æ–Ω–∞ –æ—Ç –∫—Ä–∞—è —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Å–≤–∞–π–ø–∞
      
      document.addEventListener('touchstart', (e) => {
        const touchX = e.touches[0].clientX;
        const touchY = e.touches[0].clientY;
        
        // –ù–∞—á–∏–Ω–∞–µ–º —Å–≤–∞–π–ø —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∫–∞—Å–∞–Ω–∏–µ –≤ –ø—Ä–∞–≤–æ–π —á–∞—Å—Ç–∏ —ç–∫—Ä–∞–Ω–∞
        if (touchX > window.innerWidth - swipeZone) {
          startX = touchX;
          startY = touchY;
          isSwipeActive = true;
          swipeThreshold = 0;
        }
      }, { passive: true });
      
      document.addEventListener('touchmove', (e) => {
        if (!isSwipeActive) return;
        
        currentX = e.touches[0].clientX;
        const deltaX = currentX - startX;
        const deltaY = Math.abs(e.touches[0].clientY - startY);
        
        // –ï—Å–ª–∏ —Å–≤–∞–π–ø –≤–ª–µ–≤–æ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–µ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–µ
        if (deltaX < 0 && deltaY < maxVerticalDistance) {
          const swipeDistance = Math.abs(deltaX);
          const progress = Math.min(swipeDistance / (window.innerWidth * 0.3), 1);
          
          // –ë–æ–ª–µ–µ –ø–ª–∞–≤–Ω–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Å –ª—É—á—à–∏–º –æ—Ç–∫–ª–∏–∫–æ–º
          document.body.style.transform = `translateX(${deltaX * 0.4}px)`;
          document.body.style.opacity = Math.max(0.3, 1 - progress * 0.7);
          
          // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å - –º–µ–Ω—è–µ–º –∫—É—Ä—Å–æ—Ä
          document.body.style.cursor = 'grabbing';
          
          // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ—Ä–æ–≥ –¥–ª—è —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è
          swipeThreshold = progress;
        }
      }, { passive: true });
      
      document.addEventListener('touchend', (e) => {
        if (!isSwipeActive) return;
        
        const deltaX = currentX - startX;
        const deltaY = Math.abs(e.changedTouches[0].clientY - startY);
        
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏
        document.body.style.transform = '';
        document.body.style.opacity = '';
        document.body.style.cursor = '';
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è
        if (deltaX < -minSwipeDistance && deltaY < maxVerticalDistance && swipeThreshold > 0.3) {
          // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
          document.body.classList.add('swipe-animation', 'swipe-closing');
          
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
          setTimeout(() => {
            goBack();
          }, 250);
        }
        
        isSwipeActive = false;
        swipeThreshold = 0;
      }, { passive: true });
    }
  </script>
</body>
</html>