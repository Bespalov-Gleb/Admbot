<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ó–∞–∫–∞–∑—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</title>
           <link rel="stylesheet" href="/static/styles.v23.css?v=79" />
  <style>
    /* ===== –°–û–í–†–ï–ú–ï–ù–ù–´–ô –î–ò–ó–ê–ô–ù –°–¢–†–ê–ù–ò–¶–´ –ó–ê–ö–ê–ó–û–í ===== */
    
    body {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
      min-height: 100vh;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      padding: 20px;
    }
    
    h2 {
      font-size: 28px;
      font-weight: 700;
      color: #1e293b;
      margin-bottom: 8px;
      text-align: center;
    }
    
    .meta {
      text-align: center;
      margin-bottom: 32px;
      padding: 16px;
      background: white;
      border-radius: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }
    
    .meta a {
      color: #3b82f6;
      text-decoration: none;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 8px;
      transition: all 0.2s ease;
      white-space: nowrap;
      flex-shrink: 0;
    }
    
    .meta a:hover {
      background: #f1f5f9;
      color: #1d4ed8;
    }
    
    .meta span {
      color: #94a3b8;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    /* –°–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .controls-section {
      background: white;
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .admin-btn {
      padding: 12px 20px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .admin-btn:hover {
      background: #2563eb;
      transform: translateY(-1px);
    }
    
    .admin-btn.danger {
      background: #dc2626;
    }
    
    .admin-btn.danger:hover {
      background: #b91c1c;
    }
    
    /* –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ */
    .orders-container {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .order-item {
      background: #f8fafc;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid #e2e8f0;
      transition: all 0.2s ease;
    }
    
    .order-item:hover {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }
    
    .order-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .order-id {
      font-weight: 700;
      font-size: 16px;
      color: #1e293b;
    }
    
    .order-status {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .status-sent { background: #fef3c7; color: #92400e; }
    .status-accepted { background: #d1fae5; color: #065f46; }
    .status-delivered { background: #dbeafe; color: #1e40af; }
    .status-cancelled { background: #fee2e2; color: #991b1b; }
    .status-modified { background: #f3e8ff; color: #7c3aed; }
    
    .order-details {
      font-size: 14px;
      color: #64748b;
      margin-bottom: 8px;
    }
    
    .order-items {
      margin-top: 8px;
      font-size: 13px;
      color: #6b7280;
      background: #f1f5f9;
      padding: 8px 12px;
      border-radius: 8px;
    }
    
    .order-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 12px;
      justify-content: flex-end;
    }
    
    .order-actions button {
      padding: 8px 16px;
      background: white;
      color: #374151;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 4px;
      transition: all 0.2s ease;
    }
    
    .order-actions button:hover {
      background: #f8fafc;
      transform: translateY(-1px);
    }
    
    .order-actions button.accept {
      background: #10b981;
      color: white;
      border-color: #10b981;
    }
    
    .order-actions button.accept:hover {
      background: #059669;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
    .order-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }
    
    .order-modal {
      background: white;
      border-radius: 16px;
      padding: 24px;
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 20px 25px rgba(0, 0, 0, 0.1);
      animation: slideIn 0.3s ease;
    }
    
    .order-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 16px;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .order-modal-title {
      font-size: 20px;
      font-weight: 700;
      color: #1e293b;
    }
    
    .order-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #64748b;
      padding: 4px;
      border-radius: 4px;
      transition: all 0.2s ease;
    }
    
    .order-modal-close:hover {
      background: #f1f5f9;
      color: #1e293b;
    }
    
    .order-detail-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f1f5f9;
    }
    
    .order-detail-label {
      font-weight: 600;
      color: #374151;
    }
    
    .order-detail-value {
      color: #64748b;
    }
    
    .action-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border: 1px solid #e2e8f0;
      border-radius: 8px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .action-option:hover {
      background: #f8fafc;
      border-color: #3b82f6;
    }
    
    .action-option.selected {
      background: #eff6ff;
      border-color: #3b82f6;
    }
    
    .action-option input[type="radio"] {
      margin: 0;
    }
    
    .action-option-label {
      font-weight: 500;
      color: #374151;
      cursor: pointer;
    }
    
    .order-modal-submit {
      width: 100%;
      padding: 12px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.2s ease;
    }
    
    .order-modal-submit:hover:not(:disabled) {
      background: #2563eb;
      transform: translateY(-1px);
    }
    
    .order-modal-submit:disabled {
      background: #94a3b8;
      cursor: not-allowed;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from { 
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
      }
      to { 
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 768px) {
      .container {
        padding: 16px;
      }
      
      .controls-section {
        flex-direction: column;
        align-items: stretch;
      }
      
      .order-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .order-actions {
        justify-content: stretch;
      }
      
      .order-actions button {
        flex: 1;
      }
    }
     
     .order-actions button.delivered:hover {
       background: #2563eb;
     }

    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞ */
    .order-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    
    .order-modal {
      background: white;
      border-radius: 12px;
      padding: 24px;
      max-width: 90%;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      position: relative;
      z-index: 10000;
    }
    
    .order-modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      background: none;
      border: none;
      font-size: 24px;
      color: #6b7280;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 6px;
      transition: all 0.2s ease;
    }
    
    .order-modal-close:hover {
      background: #f3f4f6;
      color: #374151;
    }
    
    .order-modal-title {
      font-size: 18px;
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 20px;
      padding-right: 40px;
    }
    
    .order-details-section {
      margin-bottom: 20px;
    }
    
    .order-detail-item {
      margin-bottom: 8px;
      font-size: 14px;
      color: #374151;
    }
    
    .order-detail-label {
      font-weight: 500;
      color: #6b7280;
    }
    
    .order-comment-section {
      margin-bottom: 20px;
      padding: 12px;
      background: #f8fafc;
      border-radius: 8px;
      border-left: 4px solid #3b82f6;
    }
    
    .order-comment-section .order-detail-item {
      margin-bottom: 0;
    }
    
    .order-comment-section .order-detail-label {
      color: #1e40af;
      font-weight: 700;
    }
    
    .order-actions-section {
      margin-bottom: 20px;
    }
    
    .action-option {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .action-option:hover {
      background: #f9fafb;
      border-color: #d1d5db;
    }
    
    .action-option.selected {
      background: #f0f9ff;
      border-color: #3b82f6;
    }
    
    .action-option input[type="radio"] {
      margin-right: 12px;
      width: 18px;
      height: 18px;
      accent-color: #3b82f6;
    }
    
    .action-option-label {
      flex: 1;
      font-size: 14px;
      color: #374151;
    }
    
    .order-modal-submit {
      width: 100%;
      padding: 16px;
      background: #dc2626;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .order-modal-submit:hover {
      background: #b91c1c;
    }
    
    .order-modal-submit:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }
     
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ */
    .order-items-edit-section {
      margin-bottom: 20px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      background: #f9fafb;
    }
    
    .order-items-list {
      max-height: 300px;
       overflow-y: auto;
     }
     
    .order-item-edit {
       display: flex;
       justify-content: space-between;
       align-items: center;
      padding: 12px;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      margin-bottom: 8px;
      background: white;
      transition: all 0.2s ease;
    }
    
    .order-item-edit.modified {
      border-color: #dc2626;
      background: #fef2f2;
      box-shadow: 0 0 0 1px #dc2626;
    }
    
    .item-info {
      flex: 1;
      margin-right: 16px;
    }
    
    .item-name {
      display: block;
      font-weight: 500;
      color: #1f2937;
      margin-bottom: 4px;
    }
    
    .item-price {
      font-size: 12px;
      color: #6b7280;
    }
    
    .item-quantity-controls {
       display: flex;
       align-items: center;
       gap: 8px;
     }
     
    .qty-btn {
      width: 32px;
      height: 32px;
       border: 1px solid #d1d5db;
      background: white;
      color: #374151;
      border-radius: 6px;
      cursor: pointer;
      font-size: 18px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }
    
    .qty-btn:hover {
       background: #f3f4f6;
      border-color: #9ca3af;
    }
    
    .qty-btn:active {
      transform: scale(0.95);
    }
    
    .qty-input {
      width: 50px;
      height: 32px;
      border: 1px solid #d1d5db;
       border-radius: 6px;
      text-align: center;
      font-size: 14px;
       font-weight: 500;
    }
    
    .qty-input:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .modify-comment-section {
      margin-bottom: 20px;
    }
    
    .comment-label {
      display: block;
      font-weight: 500;
      color: #374151;
      margin-bottom: 8px;
    }
    
    .modify-comment {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      resize: vertical;
      min-height: 80px;
      font-family: inherit;
    }
    
    .modify-comment:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .comment-note {
      font-size: 12px;
      color: #dc2626;
      margin-top: 4px;
      font-style: italic;
    }
    
    .modify-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
    
    .modify-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .modify-cancel {
      background: #f3f4f6;
      color: #374151;
    }
    
    .modify-cancel:hover {
      background: #e5e7eb;
    }
    
    .modify-save {
      background: #dc2626;
      color: white;
    }
    
    .modify-save:hover {
      background: #b91c1c;
    }
    
    .modify-save:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }
    
    /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ */
    .cancel-warning {
      display: flex;
      align-items: center;
      background: #fef3c7;
      border: 1px solid #fcd34d;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 20px;
      color: #92400e;
    }
    
    .warning-icon {
      font-size: 24px;
      margin-right: 12px;
    }
    
    .warning-text {
      font-size: 14px;
      line-height: 1.4;
    }
    
    .cancel-comment-section {
      margin-bottom: 20px;
    }
    
    .cancel-comment {
      width: 100%;
      padding: 12px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      font-size: 14px;
      resize: vertical;
      min-height: 100px;
      font-family: inherit;
    }
    
    .cancel-comment:focus {
      outline: none;
      border-color: #dc2626;
      box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
    }
    
    .cancel-actions {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }
    
    .cancel-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .cancel-back {
      background: #f3f4f6;
      color: #374151;
    }
    
    .cancel-back:hover {
      background: #e5e7eb;
    }
    
    .cancel-confirm {
      background: #dc2626;
      color: white;
    }
    
    .cancel-confirm:hover {
      background: #b91c1c;
    }
    
    .cancel-confirm:disabled {
      background: #d1d5db;
      cursor: not-allowed;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="container">
    <h2>–ó–∞–∫–∞–∑—ã —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞</h2>
    <div class="meta" style="margin-bottom:16px">
      <a id="navRestaurants" href="#">–†–µ—Å—Ç–æ—Ä–∞–Ω—ã</a>
      <span style="opacity:.4;margin:0 8px">|</span>
      <span id="navOrders" style="font-weight:600">–ó–∞–∫–∞–∑—ã</span>
      <span style="opacity:.4;margin:0 8px">|</span>
      <a id="navMenu" href="#">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–µ–Ω—é</a>
      <span style="opacity:.4;margin:0 8px">|</span>
      <a id="navProfile" href="#">–ü—Ä–æ—Ñ–∏–ª—å –∞–¥–º–∏–Ω–∞</a>
    </div>

    <div class="controls-section">
      <button id="refresh" class="admin-btn">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
      <label style="display: flex; align-items: center; gap: 8px; color: #64748b; font-weight: 500;">
        <input type="checkbox" id="auto" style="margin: 0;"/> –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª—è—Ç—å
      </label>
    </div>

    <div class="orders-container">
      <div id="olist"></div>
    </div>
  </div>

  <script>
    // ===== –û–°–ù–û–í–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï =====
    const api = location.origin + '/api';
    const q = new URLSearchParams(location.search);
    const uid = Number(q.get('uid')) || (window.Telegram?.WebApp?.initDataUnsafe?.user?.id || 0);
    const headers = uid ? { 'X-Telegram-User-Id': String(uid) } : {};
    
    // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è timezone —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
    let restaurantTimezone = 'UTC+9'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é
    
    // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –í–†–ï–ú–ï–ù–ï–ú =====
    function parseTimezone(timezone) {
      // –ü–∞—Ä—Å–∏–º timezone –≤–∏–¥–∞ "UTC+9" –∏–ª–∏ "UTC-5"
      const match = timezone.match(/UTC([+-]?\d+)/);
      if (match) {
        return parseInt(match[1]);
      }
      return 9; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é UTC+9
    }
    
    function formatDateWithTimezone(dateString, timezone) {
      const offset = parseTimezone(timezone);
      const date = new Date(dateString);
      
      // –í—Ä–µ–º—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö - –º–æ—Å–∫–æ–≤—Å–∫–æ–µ (UTC+3)
      // –ù—É–∂–Ω–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ timezone —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
      // –ù–∞–ø—Ä–∏–º–µ—Ä: –ú–æ—Å–∫–≤–∞ 14:36 (UTC+3) -> –Ø–∫—É—Ç—Å–∫ 20:36 (UTC+9)
      // –†–∞–∑–Ω–∏—Ü–∞: 9 - 3 = 6 —á–∞—Å–æ–≤
      const moscowOffset = 3; // –ú–æ—Å–∫–≤–∞ UTC+3
      const timeDifference = offset - moscowOffset; // –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É timezone —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞ –∏ –ú–æ—Å–∫–≤–æ–π
      
      const adjustedDate = new Date(date.getTime() + (timeDifference * 60 * 60 * 1000));
      
      console.log(`Formatting date: ${dateString} (Moscow UTC+3) to ${timezone} (offset: +${offset}) -> difference: +${timeDifference}h -> ${adjustedDate.toLocaleString('ru-RU')}`);
      
      return adjustedDate.toLocaleString('ru-RU', {
        day: '2-digit',
        month: '2-digit', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
    }
    
    // ===== –õ–û–ì–ò–†–û–í–ê–ù–ò–ï =====
    // Variables initialized
    
    // ===== –§–£–ù–ö–¶–ò–ò –ó–ê–ì–†–£–ó–ö–ò –ó–ê–ö–ê–ó–û–í =====
    async function simpleLoad() {
      // Loading orders
      
      try {
        // –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç API
        // Testing API
        const testRes = await fetch(api + '/ra/me', { headers });
        // API test response
        
        if (testRes.ok) {
          const testData = await testRes.json();
          // API test data loaded
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º timezone —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞
          if (testData.timezone) {
            restaurantTimezone = testData.timezone;
            console.log('Restaurant timezone loaded:', restaurantTimezone);
          } else {
            console.log('No timezone in response, using default:', restaurantTimezone);
          }
          
          // –¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
      // Loading orders
          const ordersRes = await fetch(api + '/ra/orders', { headers });
          // Orders response
          
          if (ordersRes.ok) {
            const orders = await ordersRes.json();
            // Orders loaded
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
            const olist = document.getElementById('olist');
            if (olist) {
              if (orders.length > 0) {
                let html = '<div class="meta">–ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:</div>';
                // –ó–∞–∫–∞–∑—ã —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –æ—Ç –Ω–æ–≤—ã—Ö –∫ —Å—Ç–∞—Ä—ã–º –≤ API
                orders.forEach(order => {
                  html += `<div class="order-item" onclick="openOrderDetails(${order.id})" style="cursor: pointer;">
          <div class="order-header">
                      <span class="order-id">–ó–∞–∫–∞–∑ #${order.id}</span>
                      <span class="order-status status-${order.status}">${getStatusText(order.status)}</span>
          </div>
          <div class="order-details">
                      –°—É–º–º–∞: ${order.total_price} ‚ÇΩ ¬∑ ${order.delivery_type === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑'}
          </div>
          <div class="order-details">
                      ${order.address ? `–ê–¥—Ä–µ—Å: ${order.address} ¬∑ ` : ''}–¢–µ–ª–µ—Ñ–æ–Ω: ${order.phone}
          </div>
          <div class="order-items">
                      ${Array.isArray(order.items) ? order.items.map(i => `${i.name} √ó ${i.qty}`).join(', ') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}
          </div>
          <div class="order-details">
                      ${formatDateWithTimezone(order.created_at, restaurantTimezone)}
          </div>
          </div>`;
                });
                olist.innerHTML = html;
              } else {
                olist.innerHTML = '<div class="meta">–ó–∞–∫–∞–∑–æ–≤ –Ω–µ—Ç</div>';
              }
            }
          } else {
            console.error('Failed to load orders:', ordersRes.status);
            document.getElementById('olist').innerHTML = `<div class="meta">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤: ${ordersRes.status}</div>`;
          }
        } else {
          console.error('API test failed:', testRes.status);
          document.getElementById('olist').innerHTML = `<div class="meta">API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: ${testRes.status}</div>`;
        }
        
      } catch (error) {
        console.error('Error in simpleLoad:', error);
        document.getElementById('olist').innerHTML = `<div class="meta">–û—à–∏–±–∫–∞: ${error.message}</div>`;
      }
      
              // Load completed
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –°–¢–ê–¢–£–°–û–í –ó–ê–ö–ê–ó–û–í =====
    function getStatusText(status) {
      const statusMap = {
        'sent': '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω',
        'accepted': '–ü—Ä–∏–Ω—è—Ç',
        'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω',
        'cancelled': '–û—Ç–º–µ–Ω–µ–Ω',
        'modified': '–ò–∑–º–µ–Ω–µ–Ω'
      };
      return statusMap[status] || status;
    }

    // ===== –§–£–ù–ö–¶–ò–ò –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê =====
    function selectAction(element, value) {
      console.log('selectAction called:', value);
      
      // –£–±–∏—Ä–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Å–æ –≤—Å–µ—Ö –æ–ø—Ü–∏–π
      document.querySelectorAll('.action-option').forEach(opt => {
        opt.classList.remove('selected');
        opt.querySelector('input[type="radio"]').checked = false;
      });
      
      // –í—ã–¥–µ–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –æ–ø—Ü–∏—é
      element.classList.add('selected');
      element.querySelector('input[type="radio"]').checked = true;
      
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
      const submitBtn = document.querySelector('.order-modal-submit');
      if (submitBtn) {
        submitBtn.disabled = false;
        console.log('Submit button enabled');
      }
    }
    
    async function processOrderAction(orderId) {
      console.log('processOrderAction called for order:', orderId);
      
      const selectedAction = document.querySelector('input[name="action"]:checked');
      if (!selectedAction) {
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ');
        return;
      }
      
      const action = selectedAction.value;
      console.log('Selected action:', action);
      
      const submitButton = document.querySelector('.order-modal-submit');
      submitButton.disabled = true;
      submitButton.textContent = '–û–±—Ä–∞–±–æ—Ç–∫–∞...';
      
      try {
        if (action.startsWith('accept-')) {
          const etaMinutes = parseInt(action.split('-')[1]);
          console.log('Accepting order with ETA:', etaMinutes);
          
          const res = await fetch(api + '/ra/orders/' + orderId + '/accept?eta_minutes=' + etaMinutes, {
            method: 'POST',
            headers
          });
          
          if (res.ok) {
            alert('–ó–∞–∫–∞–∑ –ø—Ä–∏–Ω—è—Ç!');
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.querySelector('.order-modal-overlay').remove();
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
            simpleLoad();
          } else {
            throw new Error('–û—à–∏–±–∫–∞ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞–∫–∞–∑–∞');
          }
        } else if (action === 'modify') {
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
          document.querySelector('.order-modal-overlay').remove();
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
          showModifyOrderModal(orderId);
          return;
        } else if (action === 'cancel') {
          console.log('=== CANCEL ACTION SELECTED ===');
          console.log('Closing main modal and opening cancel modal...');
          
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –æ–∫–Ω–æ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
          const mainModal = document.querySelector('.order-modal-overlay');
          if (mainModal) {
            console.log('Main modal found, closing...');
            mainModal.remove();
            console.log('Main modal closed');
          } else {
            console.error('Main modal not found!');
          }
          
          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
          console.log('Calling showCancelOrderModal with orderId:', orderId);
          showCancelOrderModal(orderId);
          return;
        }
        
      } catch (error) {
        console.error('Error processing order action:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–∫–∞–∑–∞: ' + error.message);
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = '–û—Ç–ø—Ä–∞–≤–∏—Ç—å';
      }
    }
    
    // ===== –§–£–ù–ö–¶–ò–Ø –ü–†–ò–ù–£–î–ò–¢–ï–õ–¨–ù–û–ì–û –û–¢–ö–†–´–¢–ò–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê =====
    async function forceOpenModal() {
      console.log('=== FORCE OPEN MODAL ===');
      
      // –ü–æ–ª—É—á–∞–µ–º order_id –∏–∑ URL
      const urlParams = new URLSearchParams(window.location.search);
      const orderId = urlParams.get('order_id') || '21'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 21 –µ—Å–ª–∏ –Ω–µ—Ç –≤ URL
      
      console.log('Force opening modal for order:', orderId);
      
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
        const res = await fetch(api + '/ra/orders/' + orderId, { headers });
        if (!res.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞: ${res.status}`);
        }
        
        const order = await res.json();
        console.log('Order data loaded:', order);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "sent"
        if (order.status !== 'sent') {
          alert('–≠—Ç–æ—Ç –∑–∞–∫–∞–∑ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –û–∫–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤.');
          return;
        }
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
        const orderDate = formatDateWithTimezone(order.created_at, restaurantTimezone);
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞
        const itemsText = order.items ? order.items.map(item => 
          `${item.name} √ó ${item.qty}`
        ).join(', ') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–∫–∞–∑–µ
        const modal = document.createElement('div');
        modal.className = 'order-modal-overlay';
        modal.innerHTML = `
          <div class="order-modal">
            <div class="order-modal-title">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞ #${orderId}</div>
            
            <div class="order-details-section">
              <div class="order-detail-item">
                <span class="order-detail-label">–ó–∞–∫–∞–∑ –Ω–æ–º–µ—Ä:</span> ${orderId}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:</span> ${getStatusText(order.status)}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–ê–¥—Ä–µ—Å:</span> ${order.address || '–°–∞–º–æ–≤—ã–≤–æ–∑'}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</span> ${order.payment_method === 'cash' ? '–ù–∞–ª–∏—á–Ω—ã–µ' : '–ö–∞—Ä—Ç–∞'}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</span> ${itemsText}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span> ${order.total_price} ‚ÇΩ
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</span> ${orderDate}
              </div>
            </div>
            
            <div class="order-comment-section">
              <div class="order-detail-item">
                <span class="order-detail-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞:</span> ${order.client_comment || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–ü—Ä–∏–±–æ—Ä—ã:</span> ${order.cutlery_count || 0} –∫–æ–º–ø–ª–µ–∫—Ç–æ–≤
              </div>
            </div>
            
            <div class="order-actions-section">
              <div class="action-option" onclick="selectAction(this, 'accept-30')">
                <input type="radio" name="action" value="accept-30" id="accept-30">
                <label class="action-option-label" for="accept-30">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 30 –º–∏–Ω</label>
              </div>
              <div class="action-option" onclick="selectAction(this, 'accept-60')">
                <input type="radio" name="action" value="accept-60" id="accept-60">
                <label class="action-option-label" for="accept-60">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 1 —á–∞—Å</label>
              </div>
              <div class="action-option" onclick="selectAction(this, 'accept-90')">
                <input type="radio" name="action" value="accept-90" id="accept-90">
                <label class="action-option-label" for="accept-90">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 1,5 —á–∞—Å–∞</label>
              </div>
              <div class="action-option" onclick="selectAction(this, 'accept-120')">
                <input type="radio" name="action" value="accept-120" id="accept-120">
                <label class="action-option-label" for="accept-120">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 2 —á–∞—Å–∞</label>
              </div>
              <div class="action-option" onclick="selectAction(this, 'accept-180')">
                <input type="radio" name="action" value="accept-180" id="accept-180">
                <label class="action-option-label" for="accept-180">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 3 —á–∞—Å–∞</label>
              </div>
              <div class="action-option" onclick="selectAction(this, 'modify')">
                <input type="radio" name="action" value="modify" id="modify">
                <label class="action-option-label" for="modify">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</label>
              </div>
              <div class="action-option" onclick="selectAction(this, 'cancel')">
                <input type="radio" name="action" value="cancel" id="cancel">
                <label class="action-option-label" for="cancel">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</label>
              </div>
            </div>
            
            <button class="order-modal-submit" onclick="processOrderAction(${orderId})" disabled>
              –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
          </div>
        `;
        
        console.log('Modal created, appending to DOM...');
        document.body.appendChild(modal);
        console.log('Modal appended! Check if visible...');
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å
        setTimeout(() => {
          const modalElement = document.querySelector('.order-modal-overlay');
          if (modalElement) {
            console.log('Modal found in DOM:', modalElement);
            console.log('Modal display style:', window.getComputedStyle(modalElement).display);
            console.log('Modal visibility style:', window.getComputedStyle(modalElement).visibility);
            console.log('Modal opacity style:', window.getComputedStyle(modalElement).opacity);
            console.log('Modal z-index style:', window.getComputedStyle(modalElement).zIndex);
          } else {
            console.error('Modal not found in DOM!');
          }
        }, 100);
        
      } catch (error) {
        console.error('Error loading order data:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞: ' + error.message);
      }
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–¢–ú–ï–ù–´ –ó–ê–ö–ê–ó–ê =====
    function showCancelOrderModal(orderId) {
      console.log('=== SHOW CANCEL ORDER MODAL ===');
      console.log('Order ID for cancellation:', orderId);
      console.log('Document body:', document.body);
      console.log('Current modals count:', document.querySelectorAll('.order-modal-overlay').length);
      
      // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
      const modal = document.createElement('div');
      modal.className = 'order-modal-overlay';
      modal.innerHTML = `
        <div class="order-modal" style="max-width: 500px;">
          <button class="order-modal-close" onclick="this.closest('.order-modal-overlay').remove()">√ó</button>
          <div class="order-modal-title">–û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞ #${orderId}</div>
          
          <div class="cancel-warning">
            <div class="warning-icon">‚ö†Ô∏è</div>
            <div class="warning-text">
              –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑? 
              –û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–º–µ–Ω–µ–Ω–∞.
            </div>
          </div>
          
          <div class="cancel-comment-section">
            <label class="comment-label">–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞:</label>
            <textarea class="cancel-comment" 
                      placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)..."
                      rows="4"></textarea>
            <div class="comment-note">* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞</div>
          </div>
          
          <div class="cancel-actions">
            <button class="cancel-btn cancel-back" onclick="this.closest('.order-modal-overlay').remove()">
              –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–∫–∞–∑—É
            </button>
            <button class="cancel-btn cancel-confirm" onclick="confirmOrderCancellation(${orderId})" disabled>
              –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑
            </button>
          </div>
        </div>
      `;
      
      console.log('Modal HTML created:', modal.outerHTML);
      console.log('Appending modal to document body...');
      
      document.body.appendChild(modal);
      console.log('Modal appended to DOM');
      console.log('Modal element in DOM:', document.querySelector('.order-modal-overlay'));
      console.log('Modal computed style:', window.getComputedStyle(modal));
      
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –æ—Ç–º–µ–Ω—ã –ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
      const commentTextarea = modal.querySelector('.cancel-comment');
      const confirmBtn = modal.querySelector('.cancel-confirm');
      
      commentTextarea.addEventListener('input', function() {
        confirmBtn.disabled = this.value.trim().length === 0;
      });
      
      // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
      commentTextarea.focus();
      
      console.log('=== CANCEL MODAL SETUP COMPLETE ===');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞
    async function confirmOrderCancellation(orderId) {
      console.log('=== CONFIRM ORDER CANCELLATION ===');
      
      const commentTextarea = document.querySelector('.cancel-comment');
      const reason = commentTextarea.value.trim();
      
      if (!reason) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞');
        commentTextarea.focus();
        return;
      }
      
      console.log('Cancelling order with reason:', reason);
      
      const confirmBtn = document.querySelector('.cancel-confirm');
      confirmBtn.disabled = true;
      confirmBtn.textContent = '–û—Ç–º–µ–Ω–∞...';
      
      try {
        const res = await fetch(api + '/ra/orders/' + orderId + '/cancel?reason=' + encodeURIComponent(reason), {
          method: 'POST',
          headers
        });
        
        if (res.ok) {
          alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–º–µ–Ω–µ–Ω!');
          // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
          document.querySelector('.order-modal-overlay').remove();
          // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
          simpleLoad();
        } else {
          throw new Error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞');
        }
        
      } catch (error) {
        console.error('Error cancelling order:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∑–∞–∫–∞–∑–∞: ' + error.message);
      } finally {
        confirmBtn.disabled = false;
        confirmBtn.textContent = '–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑';
      }
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ò–ó–ú–ï–ù–ï–ù–ò–Ø –ó–ê–ö–ê–ó–ê =====
    async function showModifyOrderModal(orderId) {
      console.log('=== SHOW MODIFY ORDER MODAL ===');
      console.log('Order ID for modification:', orderId);
      
      try {
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
        const res = await fetch(api + '/ra/orders/' + orderId, { headers });
        if (!res.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞: ${res.status}`);
        }
        
        const order = await res.json();
        console.log('Order data loaded:', order);
        
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
      const modal = document.createElement('div');
        modal.className = 'order-modal-overlay';
      modal.innerHTML = `
          <div class="order-modal" style="max-width: 95%; max-height: 90%;">
            <button class="order-modal-close" onclick="this.closest('.order-modal-overlay').remove()">√ó</button>
            <div class="order-modal-title">–ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ #${orderId}</div>
            
            <div class="order-details-section">
              <div class="order-detail-item">
                <span class="order-detail-label">–°—Ç–∞—Ç—É—Å:</span> ${getStatusText(order.status)}
          </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–°—É–º–º–∞:</span> ${order.total_price} ‚ÇΩ
                    </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–¢–∏–ø –¥–æ—Å—Ç–∞–≤–∫–∏:</span> ${order.delivery_type === 'delivery' ? '–î–æ—Å—Ç–∞–≤–∫–∞' : '–°–∞–º–æ–≤—ã–≤–æ–∑'}
                    </div>
                </div>
            
            <div class="order-items-edit-section">
              <h4 style="margin: 16px 0 12px 0; color: #1f2937; font-size: 16px;">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞</h4>
              <div class="order-items-list">
                ${order.items.map((item, index) => `
                  <div class="order-item-edit" data-index="${index}" data-original-qty="${item.qty}">
                    <div class="item-info">
                      <span class="item-name">${item.name}</span>
                      <span class="item-price">${item.price || '–¶–µ–Ω–∞ –Ω–µ —É–∫–∞–∑–∞–Ω–∞'} ‚ÇΩ</span>
                    </div>
                    <div class="item-quantity-controls">
                      <button class="qty-btn qty-minus" onclick="changeItemQuantity(${index}, -1)">‚àí</button>
                      <input type="number" class="qty-input" value="${item.qty}" min="0" max="99" 
                             onchange="updateItemQuantity(${index}, this.value)">
                      <button class="qty-btn qty-plus" onclick="changeItemQuantity(${index}, 1)">+</button>
                </div>
              </div>
            `).join('')}
          </div>
          </div>
            
            <div class="modify-comment-section">
              <label class="comment-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞:</label>
              <textarea class="modify-comment" 
                        placeholder="–£–∫–∞–∂–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)..."
                        rows="3"></textarea>
              <div class="comment-note">* –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞</div>
            </div>
            
            <div class="modify-actions">
              <button class="modify-btn modify-cancel" onclick="this.closest('.order-modal-overlay').remove()">
                –û—Ç–º–µ–Ω–∞
              </button>
              <button class="modify-btn modify-save" onclick="saveOrderModification(${orderId})" disabled>
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
              </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
        console.log('Modify modal created and appended');
        
        // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–∏ –≤–≤–æ–¥–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
        const commentTextarea = modal.querySelector('.modify-comment');
        const saveBtn = modal.querySelector('.modify-save');
        
        commentTextarea.addEventListener('input', function() {
          saveBtn.disabled = this.value.trim().length === 0;
        });
        
      } catch (error) {
        console.error('Error showing modify modal:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞: ' + error.message);
      }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª—é–¥–∞
    function changeItemQuantity(index, delta) {
      const itemElement = document.querySelector(`[data-index="${index}"]`);
      const qtyInput = itemElement.querySelector('.qty-input');
      const newQty = Math.max(0, parseInt(qtyInput.value) + delta);
      qtyInput.value = newQty;
      updateItemQuantity(index, newQty);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±–ª—é–¥–∞
    function updateItemQuantity(index, newQty) {
      const itemElement = document.querySelector(`[data-index="${index}"]`);
      const originalQty = parseInt(itemElement.dataset.originalQty);
      
      // –í–∏–∑—É–∞–ª—å–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if (newQty !== originalQty) {
        itemElement.classList.add('modified');
      } else {
        itemElement.classList.remove('modified');
        }
      }
      
    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∑–∞–∫–∞–∑–∞
    async function saveOrderModification(orderId) {
      console.log('=== SAVE ORDER MODIFICATION ===');
      
      const commentTextarea = document.querySelector('.modify-comment');
      const comment = commentTextarea.value.trim();
      
      if (!comment) {
        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é –∑–∞–∫–∞–∑–∞');
        commentTextarea.focus();
        return;
      }
      
      // –°–æ–±–∏—Ä–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
      const modifications = [];
      const itemElements = document.querySelectorAll('.order-item-edit');
      
      itemElements.forEach((itemElement, index) => {
        const originalQty = parseInt(itemElement.dataset.originalQty);
        const newQty = parseInt(itemElement.querySelector('.qty-input').value);
        
        if (newQty !== originalQty) {
          modifications.push({
            index: index,
            qty: newQty
          });
        }
      });
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
      if (modifications.length === 0 && comment.trim().length === 0) {
        alert('–ù–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –Ω–µ —É–∫–∞–∑–∞–Ω');
        return;
      }
      
      console.log('Modifications to save:', modifications);
      console.log('Comment:', comment);
      
      const saveBtn = document.querySelector('.modify-save');
      saveBtn.disabled = true;
      saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ...';
      
      try {
        // –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –±–ª—é–¥–∞—Ö, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏—Ö
        if (modifications.length > 0) {
          const res = await fetch(api + '/ra/orders/' + orderId + '/modify-items', {
          method: 'POST',
          headers: { ...headers, 'Content-Type': 'application/json' },
            body: JSON.stringify({
              items: modifications,
              comment: comment
            })
          });
          
          if (res.ok) {
            alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω–µ–Ω!');
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.querySelector('.order-modal-overlay').remove();
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
            simpleLoad();
        } else {
            const errorText = await res.text();
            throw new Error(`–û—à–∏–±–∫–∞ API: ${res.status} - ${errorText}`);
        }
        } else {
          // –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–ª—é–¥–∞—Ö, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
          const res = await fetch(api + '/ra/orders/' + orderId + '/modify?comment=' + encodeURIComponent(comment), {
            method: 'POST',
            headers: headers
          });
          
          if (res.ok) {
            alert('–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!');
            // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
            document.querySelector('.order-modal-overlay').remove();
            // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã
            simpleLoad();
          } else {
            const errorText = await res.text();
            throw new Error(`–û—à–∏–±–∫–∞ API: ${res.status} - ${errorText}`);
          }
        }
        
      } catch (error) {
        console.error('Error saving modifications:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π: ' + error.message);
      } finally {
        saveBtn.disabled = false;
        saveBtn.textContent = '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è';
      }
    }
    
    // ===== –§–£–ù–ö–¶–ò–ò –î–õ–Ø –û–¢–ö–†–´–¢–ò–Ø –î–ï–¢–ê–õ–ï–ô –ó–ê–ö–ê–ó–ê =====
    async function openOrderProcessingModal(orderId) {
      console.log('Opening order processing modal for order:', orderId);
      
      try {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
        const res = await fetch(api + '/ra/orders/' + orderId, { headers });
        if (!res.ok) {
          throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞: ${res.status}`);
        }
        
        const order = await res.json();
        console.log('Order data loaded:', order);
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
        const orderDate = formatDateWithTimezone(order.created_at, restaurantTimezone);
        
        // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞
        const itemsText = order.items ? order.items.map(item => 
          `${item.name} √ó ${item.qty}`
        ).join(', ') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
        
        // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–∫–∞–∑–µ
        const modal = document.createElement('div');
        modal.className = 'order-modal-overlay';
        modal.innerHTML = `
          <div class="order-modal">
            <div class="order-modal-title">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞ #${orderId}</div>
            
            <div class="order-details-section">
              <div class="order-detail-item">
                <span class="order-detail-label">–ó–∞–∫–∞–∑ –Ω–æ–º–µ—Ä:</span> ${orderId}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:</span> ${order.status}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–ê–¥—Ä–µ—Å:</span> ${order.address || '–ù–µ —É–∫–∞–∑–∞–Ω'}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</span> ${order.payment_method || '–ù–µ —É–∫–∞–∑–∞–Ω'}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</span> ${itemsText}
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span> ${order.total_price} ‚ÇΩ
              </div>
              <div class="order-detail-item">
                <span class="order-detail-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</span> ${orderDate}
              </div>
            </div>
            
            <div class="order-actions">
              <button class="order-modal-submit" onclick="processOrderAction(${orderId})" disabled>
                –ü—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑ –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞...
              </button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Ä–µ–º—è –¥–æ—Å—Ç–∞–≤–∫–∏
        const timeSelect = modal.querySelector('.order-modal-submit');
        if (timeSelect) {
          timeSelect.disabled = false;
        }
        
      } catch (error) {
        console.error('Error opening order processing modal:', error);
        alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞');
      }
    }

    async function openOrderDetails(orderId) {
      console.log('Opening order details for order:', orderId);
      console.log('Current uid:', uid);
      
      try {
        // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
        const orderRes = await fetch(api + '/ra/orders/' + orderId, { headers });
        if (!orderRes.ok) {
          alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞');
          return;
        }
        
        const order = await orderRes.json();
        console.log('Order status:', order.status);
        console.log('Order status type:', typeof order.status);
        console.log('Full order data:', order);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ - –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "sent" –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
        if (order.status === 'sent') {
          // –î–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏
          await openOrderProcessingModal(orderId);
          return;
        }
        
        // –î–ª—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π
        
        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞
        const p = new URLSearchParams(location.search);
        if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1');
        p.set('order_id', orderId);
        
        // –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è–µ–º uid –≤ URL
        if (uid) {
          p.set('uid', uid);
          console.log('Added uid to URL:', uid);
        } else {
          console.error('No uid available!');
          alert('–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
          return;
        }
        
        const targetUrl = '/static/ra_order_details.html?' + p.toString();
        console.log('Navigating to:', targetUrl);
        window.location.href = targetUrl;
        
      } catch (error) {
        console.error('Error checking order status:', error);
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞');
      }
    }
    
    // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô =====
    document.addEventListener('DOMContentLoaded', function() {
      console.log('=== DOM LOADED ===');
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
      document.getElementById('navRestaurants').onclick = (e) => {
        e.preventDefault();
        const p = new URLSearchParams(location.search);
        if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1');
        location.href = '/static/index.html?' + p.toString();
      };
      
      document.getElementById('navMenu').onclick = (e) => {
        e.preventDefault();
        const p = new URLSearchParams(location.search);
        if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1');
        location.href = '/static/ra_menu.html?' + p.toString();
      };
      
      document.getElementById('navProfile').onclick = (e) => {
        e.preventDefault();
        const p = new URLSearchParams(location.search);
        if (!p.get('ngrok-skip-browser-warning')) p.set('ngrok-skip-browser-warning', '1');
        location.href = '/static/ra_profile.html?' + p.toString();
      };
      
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ "–û–±–Ω–æ–≤–∏—Ç—å"
      const refreshBtn = document.getElementById('refresh');
      if (refreshBtn) {
        console.log('Refresh button found, adding click handler');
        refreshBtn.onclick = function() {
          console.log('Refresh button clicked!');
          simpleLoad();
        };
      } else {
        console.error('Refresh button not found!');
      }
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —ç–ª–µ–º–µ–Ω—Ç olist
      const olist = document.getElementById('olist');
      if (olist) {
        console.log('olist element found:', olist);
        olist.innerHTML = '<div class="meta">–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞. –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤.</div>';
      } else {
        console.error('olist element not found!');
      }
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–∫–∞–∑—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
      console.log('Auto-loading orders...');
      simpleLoad();
      
      // –ü–†–û–í–ï–†–Ø–ï–ú, –ï–°–¢–¨ –õ–ò order_id –í URL –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–û–ì–û –û–¢–ö–†–´–¢–ò–Ø –ú–û–î–ê–õ–¨–ù–û–ì–û –û–ö–ù–ê
      const urlParams = new URLSearchParams(window.location.search);
      const orderId = urlParams.get('order_id');
      
      console.log('=== URL PARAMS CHECK ===');
      console.log('Full URL:', window.location.href);
      console.log('Search params:', window.location.search);
      console.log('URLParams object:', urlParams);
      console.log('Order ID found:', orderId);
      console.log('Order ID type:', typeof orderId);
      console.log('Order ID truthy check:', !!orderId);
      
      if (orderId) {
        console.log('=== ORDER_ID FOUND IN URL ===');
        console.log('Order ID:', orderId);
        console.log('Will open modal automatically after loading orders...');
        
        // –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤ –∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        setTimeout(async () => {
          console.log('=== OPENING MODAL AUTOMATICALLY ===');
          console.log('Opening modal for order:', orderId);
          console.log('Current time:', new Date().toISOString());
          
          
          try {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–∞
            const res = await fetch(api + '/ra/orders/' + orderId, { headers });
            if (!res.ok) {
              throw new Error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–∞: ${res.status}`);
            }
            
            const order = await res.json();
            console.log('Order data loaded:', order);
            console.log('Order status:', order.status);
            console.log('Order status type:', typeof order.status);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ - –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ "sent"
            if (order.status !== 'sent') {
              alert(`–≠—Ç–æ—Ç –∑–∞–∫–∞–∑ —É–∂–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω. –°—Ç–∞—Ç—É—Å: "${order.status}". –û–∫–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–∞–∫–∞–∑–æ–≤.`);
              return;
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
            const orderDate = formatDateWithTimezone(order.created_at, restaurantTimezone);
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º —Å–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞
            const itemsText = order.items ? order.items.map(item => 
              `${item.name} √ó ${item.qty}`
            ).join(', ') : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            
            // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–∞–∫–∞–∑–µ
            const modal = document.createElement('div');
            modal.className = 'order-modal-overlay';
            modal.innerHTML = `
              <div class="order-modal">
                <div class="order-modal-title">–û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–∞ #${orderId}</div>
                
                <div class="order-details-section">
                  <div class="order-detail-item">
                    <span class="order-detail-label">–ó–∞–∫–∞–∑ –Ω–æ–º–µ—Ä:</span> ${orderId}
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">–°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞:</span> ${getStatusText(order.status)}
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">–ê–¥—Ä–µ—Å:</span> ${order.address || '–°–∞–º–æ–≤—ã–≤–æ–∑'}
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã:</span> ${order.payment_method === 'cash' ? '–ù–∞–ª–∏—á–Ω—ã–µ' : '–ö–∞—Ä—Ç–∞'}
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">–°–æ—Å—Ç–∞–≤ –∑–∞–∫–∞–∑–∞:</span> ${itemsText}
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span> ${order.total_price} ‚ÇΩ
                  </div>
                  <div class="order-detail-item">
                    <span class="order-detail-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è:</span> ${orderDate}
                  </div>
                </div>
                
                <div class="order-comment-section">
                  <div class="order-detail-item">
                    <span class="order-detail-label">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫–ª–∏–µ–Ω—Ç–∞:</span> ${order.client_comment || '–ù–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è'}
                  </div>
                </div>
                
                <div class="order-actions-section">
                  <div class="action-option" onclick="selectAction(this, 'accept-30')">
                    <input type="radio" name="action" value="accept-30" id="accept-30">
                    <label class="action-option-label" for="accept-30">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 30 –º–∏–Ω</label>
                  </div>
                  <div class="action-option" onclick="selectAction(this, 'accept-60')">
                    <input type="radio" name="action" value="accept-60" id="accept-60">
                    <label class="action-option-label" for="accept-60">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 1 —á–∞—Å</label>
                  </div>
                  <div class="action-option" onclick="selectAction(this, 'accept-90')">
                    <input type="radio" name="action" value="accept-90" id="accept-90">
                    <label class="action-option-label" for="accept-90">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 1,5 —á–∞—Å–∞</label>
                  </div>
                  <div class="action-option" onclick="selectAction(this, 'accept-120')">
                    <input type="radio" name="action" value="accept-120" id="accept-120">
                    <label class="action-option-label" for="accept-120">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 2 —á–∞—Å–∞</label>
                  </div>
                  <div class="action-option" onclick="selectAction(this, 'accept-180')">
                    <input type="radio" name="action" value="accept-180" id="accept-180">
                    <label class="action-option-label" for="accept-180">–ü—Ä–∏–Ω—è—Ç—å –∏ –¥–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞ 3 —á–∞—Å–∞</label>
                  </div>
                  <div class="action-option" onclick="selectAction(this, 'modify')">
                    <input type="radio" name="action" value="modify" id="modify">
                    <label class="action-option-label" for="modify">–ò–∑–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</label>
                  </div>
                  <div class="action-option" onclick="selectAction(this, 'cancel')">
                    <input type="radio" name="action" value="cancel" id="cancel">
                    <label class="action-option-label" for="cancel">–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–∫–∞–∑</label>
                  </div>
                </div>
                
                <button class="order-modal-submit" onclick="processOrderAction(${orderId})" disabled>
                  –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                </button>
              </div>
            `;
            
            console.log('Modal HTML created, appending to DOM');
            console.log('Modal element:', modal);
            console.log('Modal HTML:', modal.outerHTML);
            console.log('Document body:', document.body);
            
            document.body.appendChild(modal);
            console.log('Modal appended to DOM - should be visible now!');
            console.log('Modal in DOM:', document.querySelector('.order-modal-overlay'));
            console.log('Modal computed style:', window.getComputedStyle(modal));
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–∏–¥–∏–º–æ—Å—Ç–∏
            setTimeout(() => {
              const modalElement = document.querySelector('.order-modal-overlay');
              if (modalElement) {
                console.log('Modal found after timeout:', modalElement);
                console.log('Modal display:', window.getComputedStyle(modalElement).display);
                console.log('Modal visibility:', window.getComputedStyle(modalElement).visibility);
                console.log('Modal opacity:', window.getComputedStyle(modalElement).opacity);
                console.log('Modal z-index:', window.getComputedStyle(modalElement).zIndex);
              } else {
                console.error('Modal not found in DOM after timeout!');
              }
            }, 100);
            
          } catch (error) {
            console.error('Error loading order data:', error);
            alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞: ' + error.message);
          }
          
        }, 3000); // –ñ–¥–µ–º 3 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
          } else {
        console.log('=== NO ORDER_ID IN URL ===');
        console.log('Modal will not open automatically');
      }
    });
  </script>
</body>
</html>

